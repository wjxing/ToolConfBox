#!/bin/bash

if [ $# != 1 ]; then
    echo "Need one arg to session name"
    exit 1
fi


SESSION_NAME=$1
echo "Session $SESSION_NAME"

tmux has-session -t $SESSION_NAME
if [ $? == 0 ]; then
    exit 0
fi

CODE_BASE=$HOME/Workspace/Code/SDK/Boot_$SESSION_NAME
if [ ! -d $CODE_BASE ]; then
    echo "Code base $CODE_BASE not exist"
    exit 1
fi

ATF=$CODE_BASE/AF
UBOOT=$CODE_BASE/au
KERN=$CODE_BASE/al

tmux new-session -s $SESSION_NAME -n atf -d

tmux split-window -h -t $SESSION_NAME
tmux split-window -v -t $SESSION_NAME
tmux select-pane -R
tmux split-window -v -t $SESSION_NAME
tmux send-keys -t $SESSION_NAME:0.0 "cd $ATF" C-m
tmux send-keys -t $SESSION_NAME:0.1 "cd $ATF" C-m
tmux send-keys -t $SESSION_NAME:0.2 "cd $CODE_BASE" C-m
tmux send-keys -t $SESSION_NAME:0.3 "cd $CODE_BASE" C-m
tmux select-pane -t 0

tmux new-window -t $SESSION_NAME -n uboot
tmux split-window -h -t $SESSION_NAME
tmux split-window -v -t $SESSION_NAME
tmux select-pane -R
tmux split-window -v -t $SESSION_NAME
tmux send-keys -t $SESSION_NAME:1.0 "cd $UBOOT" C-m
tmux send-keys -t $SESSION_NAME:1.1 "cd $UBOOT" C-m
tmux send-keys -t $SESSION_NAME:1.2 "cd $CODE_BASE" C-m
tmux send-keys -t $SESSION_NAME:1.3 "cd $CODE_BASE" C-m
tmux select-pane -t 0

tmux new-window -t $SESSION_NAME -n kern
tmux split-window -h -t $SESSION_NAME
tmux split-window -v -t $SESSION_NAME
tmux select-pane -R
tmux split-window -v -t $SESSION_NAME
tmux send-keys -t $SESSION_NAME:2.0 "cd $KERN" C-m
tmux send-keys -t $SESSION_NAME:2.1 "cd $KERN" C-m
tmux send-keys -t $SESSION_NAME:2.2 "cd $CODE_BASE" C-m
tmux send-keys -t $SESSION_NAME:2.3 "cd $CODE_BASE" C-m
tmux select-pane -t 0

tmux attach -t $SESSION_NAME
